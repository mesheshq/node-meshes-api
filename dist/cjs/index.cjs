"use strict";var o=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var E=(n,e)=>{for(var r in e)o(n,r,{get:e[r],enumerable:!0})},p=(n,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of $(e))!k.call(n,t)&&t!==r&&o(n,t,{get:()=>e[t],enumerable:!(a=A(e,t))||a.enumerable});return n};var S=n=>p(o({},"__esModule",{value:!0}),n);var O={};E(O,{MeshesApiClient:()=>w,MeshesApiError:()=>s,default:()=>C});module.exports=S(O);var s=class extends Error{constructor(e,r){super(e),this.name=this.constructor.name,typeof r<"u"&&(this.data=r)}};s.prototype.toJSON=function(n=!1){let e=n===!0?{stack:this.stack}:{};return typeof this.data>"u"?{name:this.name,message:this.message,...e}:{name:this.name,message:this.message,data:this.data,...e}};var y=async n=>{let e=await n.text();if(!e)return null;try{return JSON.parse(e)}catch{return e}};var P=require("jose");var T=3e4,I=new Set(["accept","authorization","connection","content-length","content-type","host","user-agent","transfer-encoding","x-amz-date","x-api-key","x-amz-security-token","x-amz-user-agent","x-meshes-client","x-meshes-publishable-key"]),R=["GET","POST","PUT","PATCH","DELETE"],M={version:"v1",timeout:5e3,debug:!1},g=class{#i;#r;#n;#u;#h;#d;#s;constructor(e,r,a,t={}){let d={organizationId:/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,accessKey:/^mk_[A-Za-z0-9_-]{22,}$/,secretKey:/^[A-Za-z0-9_-]{43,}$/};if(typeof e!="string"||!d.organizationId.test(e))throw new s(`Missing or invalid account organization ID: ${e}`);if(typeof r!="string"||!d.accessKey.test(r))throw new s(`Missing or invalid access key: ${r}`);if(typeof a!="string"||!d.secretKey.test(a))throw new s(`Missing or invalid secret key: ${a}`);if(!t||typeof t!="object")throw new s(`Invalid options object: ${typeof t}`,t);if(t={...M,...t},typeof t.version!="string")throw new s(`Invalid API version: ${t.version}`);if(t.version!=="v1")throw new s(`Unsupported API version: ${t.version}`);if(typeof t.timeout<"u"){if(typeof t.timeout!="number")throw new s(`Invalid request timeout: ${t.timeout}`);if(t.timeout<1e3||t.timeout>T)throw new s(`Unsupported request timeout: ${t.timeout}`)}if(typeof t.headers<"u"){if(!t.headers||typeof t.headers!="object"||Array.isArray(t.headers))throw new s(`Invalid additional request headers: ${typeof t.headers}`,t.headers);for(let[f,l]of Object.entries(t.headers)){if(typeof l!="string")throw new s(`Invalid request header value for ${f}: ${typeof l}`,t.headers);if(I.has(f.toLowerCase()))throw new s(`Header not allowed: ${f}`,t.headers)}}this.#i=e,this.#r=r,this.#n=new TextEncoder().encode(a),this.#u=t.apiBaseUrl??`https://api.meshes.io/api/${t.version}`,this.#h={...this.#f(t.headers),"X-Meshes-Client":"Meshes API Client v1.0.0","Content-Type":"application/json",Accept:"application/json"},this.#d=t.timeout,this.#s=t.debug===!0}#e(e){this.#s&&console.debug(...arguments)}#a(e){this.#s&&console.error(...arguments)}async#c(){return new P.SignJWT({org:this.#i}).setProtectedHeader({alg:"HS256",typ:"JWT",kid:this.#r}).setIssuer(`urn:meshes:m2m:${this.#r}`).setAudience("meshes-api").setIssuedAt().setExpirationTime("30s").sign(this.#n)}async#m(e){let r=await this.#c();return e.headers.Authorization=`Bearer ${r}`,e}#f(e){if(!e||typeof e!="object")return{};let r={};for(let[a,t]of Object.entries(e)){if(typeof a!="string"||typeof t!="string"){this.#e("Invalid Header",a,t);continue}let d=a.trim(),f=t.trim();!d||!f||I.has(d.toLowerCase())||(r[d]=f)}return r}#t(e,r){this.#e("Request Options",e,r?"Callback":"Promise");let a=globalThis.AbortController??void 0,t=a?new a:void 0,d=typeof(e==null?void 0:e.timeout)=="number"?e.timeout:this.#d,f=a?setTimeout(()=>t==null?void 0:t.abort(),d):void 0;t===void 0&&this.#e("AbortController","Not Supported; Timeouts won't be enforced");let l=new Promise((c,h)=>{var q;if(typeof e!="object"||e===null)return this.#e("Invalid Request Options",e),h(new s("Invalid request options",e));let m=(q=e==null?void 0:e.method)==null?void 0:q.toUpperCase();if(!m||typeof m!="string")return this.#e("Invalid Request Method",e),h(new s("Invalid request method",e));if(!R.includes(m))return this.#e("Invalid Request Method Option",e),h(new s("Unsupported request method",e));if(!(e!=null&&e.path)||typeof e.path!="string"||e.path.trim().length===0||e.path.trim()==="/")return this.#e("Invalid Request Path",e),h(new s("Invalid request path",e));if(typeof(e==null?void 0:e.timeout)<"u"){if(typeof e.timeout!="number")return this.#e("Invalid Request Timeout",e),h(new s("Invalid request timeout",e));if(e.timeout<1e3||e.timeout>T)return this.#e("Unsupported Request Timeout",e),h(new s("Unsupported request timeout",e))}if(typeof e.query<"u"&&(!e.query||typeof e.query!="object"||Array.isArray(e.query)))return this.#e("Invalid Request Query Params",e),h(new s("Invalid request query params",e));let b=e.query?`?${new URLSearchParams(Object.entries(e.query).reduce((i,[u,x])=>(i[u]=String(x),i),{})).toString()}`:"",v=e.path.charAt(0)!=="/"?`/${e.path}`:e.path;return this.#e("Fetch Options",{method:m,path:v,query:b}),this.#m({method:m,headers:{...this.#f(e.headers),...this.#h},body:e.body?typeof e.body=="string"?e.body:JSON.stringify(e.body):null,signal:t==null?void 0:t.signal}).then(i=>fetch(`${this.#u}${v}${b}`,i)).then(i=>{i.ok?y(i).then(u=>{this.#e("Response Success"),c(u)}).catch(u=>{this.#a("Response Parsing Error",u),h(new s("Error parsing response data",u))}):y(i).then(u=>{this.#e("Response Error",u),h(new s("Meshes API request failed",{status:i.status,statusText:i.statusText,data:u}))}).catch(u=>{this.#a("Response Parsing Failure",u),h(new s("Error parsing request failure",{status:i.status,statusText:i.statusText,error:u}))})}).catch(i=>{this.#a("Request Failure",i),h(i instanceof s?i:new s("Request Failure",i))})}).then(c=>{if(this.#e("Promise Success",c),r){this.#e("Promise Success","Callback Success"),r(null,c);return}return c}).catch(c=>{if(this.#e("Promise Error",c),r){this.#e("Promise Error","Callback Error"),r(c);return}throw c}).finally(()=>{f&&clearTimeout(f)});if(!r)return this.#e("Promise Returned","No callback"),l}get(e,r={},a=void 0){return this.#t({...r,path:e,method:"GET"},a)}post(e,r,a={},t=void 0){return this.#t({...a,path:e,method:"POST",body:r},t)}put(e,r,a={},t=void 0){return this.#t({...a,path:e,method:"PUT",body:r},t)}patch(e,r,a={},t=void 0){return this.#t({...a,path:e,method:"PATCH",body:r},t)}delete(e,r={},a=void 0){return this.#t({...r,path:e,method:"DELETE"},a)}},w=g;var C=w;0&&(module.exports={MeshesApiClient,MeshesApiError});
/**
 * JavaScript Meshes API Client
 * @module meshes-api
 * @license MIT
 * @since 1.0.0
 * @description Meshes API client for management APIs.
 * @repository https://github.com/mesheshq/node-meshes-api
 */
